# Upgradeable Contracts - –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤

## –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
- **SplitBillEscrowUpgradeable.sol** - Upgradeable –≤–µ—Ä—Å–∏—è —ç—Å–∫—Ä–æ—É –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
- **BillMetadataRegistryUpgradeable.sol** - Upgradeable –≤–µ—Ä—Å–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

### Legacy (—Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏)
- SplitBillEscrow.sol - –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è (–Ω–µ upgradeable)
- BillMetadataRegistry.sol - –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è (–Ω–µ upgradeable)

## –°–∫—Ä–∏–ø—Ç—ã –¥–µ–ø–ª–æ—è

- **deploy-upgradeable.sh** - –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –¥–µ–ø–ª–æ–π —Å proxy (–û–°–ù–û–í–ù–û–ô)
- **upgrade-contracts.sh** - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ (–û–°–ù–û–í–ù–û–ô)
- test-upgrade.sh - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ upgrade —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
- deploy.sh - Legacy –¥–µ–ø–ª–æ–π (—Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è)
- deploy-simple.sh - –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –¥–µ–ø–ª–æ–π (—Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è)
- deploy-metadata-registry.sh - –î–µ–ø–ª–æ–π —Ç–æ–ª—å–∫–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (—Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è)

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

- **foundry-upgradeable.toml** - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Foundry –¥–ª—è upgradeable –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤
- foundry.toml - –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Foundry

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (–ß–ò–¢–ê–¢–¨ –í –ü–ï–†–í–£–Æ –û–ß–ï–†–ï–î–¨)
1. **UPGRADEABLE_SUMMARY.md** - –ò—Ç–æ–≥–æ–≤–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (–ù–ê–ß–ù–ò–¢–ï –û–¢–°–Æ–î–ê)
2. **UPGRADEABLE_GUIDE.md** - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ
3. **MIGRATION_PLAN.md** - –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ —Å legacy –≤–µ—Ä—Å–∏–π
4. **COMMANDS_CHEATSHEET.md** - –®–ø–∞—Ä–≥–∞–ª–∫–∞ –ø–æ –≤—Å–µ–º –∫–æ–º–∞–Ω–¥–∞–º

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
5. **ARCHITECTURE.md** - –í–∏–∑—É–∞–ª—å–Ω—ã–µ —Å—Ö–µ–º—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
6. **DEPLOYMENT_CHECKLIST.md** - –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –¥–µ–ø–ª–æ—è
7. **UPGRADEABLE_FILES.md** - –≠—Ç–æ—Ç —Ñ–∞–π–ª (—Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤)
8. README.md - –û–±—â–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (–æ–±–Ω–æ–≤–ª–µ–Ω–∞ —Å upgradeable)

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
contracts/
‚îú‚îÄ‚îÄ –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ SplitBillEscrowUpgradeable.sol          ‚≠ê –ù–û–í–´–ô
‚îÇ   ‚îú‚îÄ‚îÄ BillMetadataRegistryUpgradeable.sol     ‚≠ê –ù–û–í–´–ô
‚îÇ   ‚îú‚îÄ‚îÄ SplitBillEscrow.sol                     (legacy)
‚îÇ   ‚îî‚îÄ‚îÄ BillMetadataRegistry.sol                (legacy)
‚îÇ
‚îú‚îÄ‚îÄ –°–∫—Ä–∏–ø—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ deploy-upgradeable.sh                   ‚≠ê –û–°–ù–û–í–ù–û–ô
‚îÇ   ‚îú‚îÄ‚îÄ upgrade-contracts.sh                    ‚≠ê –û–°–ù–û–í–ù–û–ô
‚îÇ   ‚îú‚îÄ‚îÄ test-upgrade.sh
‚îÇ   ‚îú‚îÄ‚îÄ deploy.sh                               (legacy)
‚îÇ   ‚îú‚îÄ‚îÄ deploy-simple.sh                        (legacy)
‚îÇ   ‚îú‚îÄ‚îÄ deploy-metadata-registry.sh             (legacy)
‚îÇ   ‚îú‚îÄ‚îÄ test-refund-features.sh
‚îÇ   ‚îî‚îÄ‚îÄ verify.sh
‚îÇ
‚îú‚îÄ‚îÄ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ foundry-upgradeable.toml                ‚≠ê –ù–û–í–´–ô
‚îÇ   ‚îî‚îÄ‚îÄ foundry.toml
‚îÇ
‚îî‚îÄ‚îÄ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
    ‚îú‚îÄ‚îÄ UPGRADEABLE_SUMMARY.md                  ‚≠ê –ù–ê–ß–ù–ò–¢–ï –û–¢–°–Æ–î–ê
    ‚îú‚îÄ‚îÄ UPGRADEABLE_GUIDE.md                    ‚≠ê –í–ê–ñ–ù–û
    ‚îú‚îÄ‚îÄ MIGRATION_PLAN.md                       ‚≠ê –í–ê–ñ–ù–û
    ‚îú‚îÄ‚îÄ COMMANDS_CHEATSHEET.md                  ‚≠ê –í–ê–ñ–ù–û
    ‚îú‚îÄ‚îÄ ARCHITECTURE.md
    ‚îú‚îÄ‚îÄ DEPLOYMENT_CHECKLIST.md
    ‚îú‚îÄ‚îÄ UPGRADEABLE_FILES.md                    (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
    ‚îî‚îÄ‚îÄ README.md                               (–æ–±–Ω–æ–≤–ª–µ–Ω)
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –î–ª—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

1. –ß–∏—Ç–∞–π—Ç–µ: `UPGRADEABLE_SUMMARY.md`
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `forge install OpenZeppelin/openzeppelin-contracts-upgradeable`
3. –î–µ–ø–ª–æ–π—Ç–µ: `./deploy-upgradeable.sh`
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∞–¥—Ä–µ—Å–∞ –≤ `.env.local`

### –î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

1. –†–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ: `SplitBillEscrowUpgradeable.sol`
2. –û–±–Ω–æ–≤–ª—è–π—Ç–µ: `./upgrade-contracts.sh`
3. –ì–æ—Ç–æ–≤–æ! –ê–¥—Ä–µ—Å–∞ –Ω–µ –º–µ–Ω—è—é—Ç—Å—è

### –î–ª—è –∏–∑—É—á–µ–Ω–∏—è

1. `UPGRADEABLE_SUMMARY.md` - –û–±—â–∏–π –æ–±–∑–æ—Ä
2. `ARCHITECTURE.md` - –í–∏–∑—É–∞–ª—å–Ω—ã–µ —Å—Ö–µ–º—ã
3. `UPGRADEABLE_GUIDE.md` - –î–µ—Ç–∞–ª—å–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
4. `COMMANDS_CHEATSHEET.md` - –í—Å–µ –∫–æ–º–∞–Ω–¥—ã

## –ß—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ (Upgradeable)

- SplitBillEscrowUpgradeable.sol
- BillMetadataRegistryUpgradeable.sol
- deploy-upgradeable.sh
- upgrade-contracts.sh
- foundry-upgradeable.toml

### ‚ö†Ô∏è Legacy (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è –Ω–æ–≤—ã—Ö –¥–µ–ø–ª–æ–µ–≤)

- SplitBillEscrow.sol
- BillMetadataRegistry.sol
- deploy.sh
- deploy-simple.sh
- deploy-metadata-registry.sh

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### –¢—Ä–µ–±—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å

```bash
# OpenZeppelin Upgradeable
forge install OpenZeppelin/openzeppelin-contracts-upgradeable --no-commit

# jq (–¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON)
brew install jq  # macOS
apt install jq   # Linux
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

```bash
forge --version          # Foundry
cast --version           # Cast
jq --version             # jq
ls lib/openzeppelin-contracts-upgradeable  # OpenZeppelin
```

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –î–ª—è testnet

```bash
export PRIVATE_KEY=your_key_without_0x
export BASE_SEPOLIA_RPC_URL=https://sepolia.base.org
```

### –î–ª—è mainnet

```bash
export PRIVATE_KEY=your_mainnet_key
export BASE_MAINNET_RPC_URL=https://mainnet.base.org
```

### –í .env.local

```env
NEXT_PUBLIC_ESCROW_ADDRESS=0x...              # Proxy –∞–¥—Ä–µ—Å
NEXT_PUBLIC_METADATA_REGISTRY_ADDRESS=0x...   # Proxy –∞–¥—Ä–µ—Å
```

## –í–∞–∂–Ω—ã–µ –∞–¥—Ä–µ—Å–∞

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ:

1. **Proxy –∞–¥—Ä–µ—Å–∞** (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏)
   - Escrow Proxy: 0x...
   - Metadata Proxy: 0x...

2. **Implementation –∞–¥—Ä–µ—Å–∞** (–¥–ª—è –æ—Ç–∫–∞—Ç–∞)
   - Escrow Implementation V1: 0x...
   - Metadata Implementation V1: 0x...

3. **Owner –∞–¥—Ä–µ—Å** (–∫—Ç–æ –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å)
   - Owner: 0x...

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [OpenZeppelin Upgradeable Contracts](https://docs.openzeppelin.com/contracts/4.x/upgradeable)
- [UUPS Pattern](https://docs.openzeppelin.com/contracts/4.x/api/proxy#UUPSUpgradeable)
- [Foundry Book](https://book.getfoundry.sh/)
- [Base Documentation](https://docs.base.org/)

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `UPGRADEABLE_SUMMARY.md`
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ `COMMANDS_CHEATSHEET.md`
3. –ò–∑—É—á–∏—Ç–µ `ARCHITECTURE.md`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `DEPLOYMENT_CHECKLIST.md`

## Changelog

- **2025-10-21**: –°–æ–∑–¥–∞–Ω–∞ upgradeable –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
  - –î–æ–±–∞–≤–ª–µ–Ω—ã UUPS proxy –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
  - –°–æ–∑–¥–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã –¥–µ–ø–ª–æ—è –∏ upgrade
  - –ù–∞–ø–∏—Å–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
  - –ì–æ—Ç–æ–≤–æ –¥–ª—è production

---

**–í—Å–µ –≥–æ—Ç–æ–≤–æ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è –ø—Ä–æ–µ–∫—Ç–∞! üöÄ**
